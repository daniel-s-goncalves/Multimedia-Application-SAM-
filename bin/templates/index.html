<!DOCTYPE html>
<html class="h-100">

  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>SAM | Image Editor</title>
      <!-- Bootstrap core CSS -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
      <link href="{{ url_for('static', filename='bootstrap.min.css') }}" rel="stylesheet">
      <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
  </head>

  <body class="d-flex h-100 text-center text-white bg-dark">
      <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="mb-auto text-center">
          <h3>Image Editor</h3>
        </header>
      
        <main class="px-3">
          <h1>Upload Image.</h1>
          <p class="lead">Try uploading an image and see how the server responds.</p>
          <div class="mb-3">
            <input class="form-control" style="width: 50%; margin: auto;" type="file" id="fileUpload">
            <div id="loadingView" class="spinner-border invisible-view" role="status"></div>
          </div>
        </main>
      
        <footer class="mt-auto text-white-50">
          <p>SAM | FEUP | 2022</p>
        </footer>
      </div>
      <img id="imageDisplay" src="#" alt="Preview Image" class="invisible-view m-auto" style="height: 60vh;"/>
      <canvas width="400" height="300" id="canvas" class="invisible-view m-auto"/>
    </body>
  
    <script src="{{ url_for('static', filename='bootstrap.bundle.min.js') }}"></script>
    
    <!-- WRONG IMAGE
    <script>
      const fileUpload = document.getElementById("fileUpload");
      fileUpload.addEventListener("change", handleFiles, false);

      function handleFiles(){
        let fileD = this.files[0];
        console.log("The file name is: " + fileD.name)
        console.log("The file size is: " + fileD.size + " bytes.")

        let formData = new FormData();
        formData.append("file", fileD);

        console.log(fileD)

        // Send Request
        var httpRequest = new XMLHttpRequest();
        httpRequest.open("POST", '/imageEditor', true);
        //httpRequest.setRequestHeader("Content-Type", "multipart/form-data");
        httpRequest.onreadystatechange = function(){ 
            if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                console.log("Terminated. Please, read from Server console to check the data sent.")
            }
        }
        httpRequest.send(formData);
      }
    </script>
    -->

    <script>
      const fileUpload = document.getElementById("fileUpload");
      const loader = document.getElementById("loadingView");
      const imageDisplay = document.getElementById("imageDisplay");
      const canvasObject = document.getElementById("canvas");
      fileUpload.addEventListener("change", displayImage, false);

      function displayImage(){
        let imageFile = this.files[0];
        displayElement(fileUpload, false)
        displayElement(loader, true)
        console.log("The file name is: " + imageFile.name)
        console.log("The file size is: " + imageFile.size + " bytes.")
        
        let context = canvasObject.getContext('2d');
        let imageObject = new Image;
        imageObject.onload = function(){
            context.drawImage(imageObject,0,0);
            displayElement(loader, false)
            displayElement(canvasObject, true)
        }
        imageObject.src = URL.createObjectURL(imageFile);
        /*
        let reader = new FileReader();
        reader.onload = function(){
          let dataURL = reader.result;
          let output = document.getElementById('imageDisplay');
          displayElement(loader, false)
          displayElement(output, true);
          output.src = dataURL;
        };
        reader.readAsDataURL(imageFile);
        */
      }

      function displayElement(element, showOnScreen){
        if(showOnScreen)
          element.classList.remove("invisible-view");
        else
          element.classList.add("invisible-view");
      }
    </script>



</html>